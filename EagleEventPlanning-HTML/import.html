<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Eagle Event Planning</title>
<link rel="stylesheet" type="text/css" href="style.css">
<script src="js/jquery-3.2.1.min.js"></script>
</head>
<body>
<script>
function getCurrentUser() {
    	$.ajax({
    	    url: "/EagleEventPlanning/services/employees/current",
    	    type: 'GET',
    	    datatype: 'json',
    	    statusCode: {
    	    200: function( planner ) {
    	
    			$('#userWelcome').html("Welcome, "+planner.name);
    	    },
    	    401:function( response ) {
    			$('#userWelcome').html("You must login first.");
    	    },
    	    
    	    error: function(jqXHR, textStatus, errorThrown) {
      	        console.log("error " + textStatus);
      	        console.log("incoming Text " + jqXHR.responseText);},
    	    beforeSend: setHeader       
    	  });   	
    }
  
	function getCookie(cname) {
	    var name = cname + "=";
	    var decodedCookie = decodeURIComponent(document.cookie);
	    var ca = decodedCookie.split(';');
	    for(var i = 0; i <ca.length; i++) {
	        var c = ca[i];
	        while (c.charAt(0) == ' ') {
	            c = c.substring(1);
	        }
	        if (c.indexOf(name) == 0) {
	            return c.substring(name.length, c.length);
	        }
	    }
	    return "";
	}
	
	function setHeader(xhr) {
		  token = getCookie("token");
		  xhr.setRequestHeader('Authorization', 'Bearer '+token );		  
	}
	$(document).ready(function() {
    		getCurrentUser();
    })
</script>
<h1>Eagle Event Planning</h1>
<div style="color: white; background: gray; width: 100%; font-size: 12;">
<table class="nav">
	<tr>
		<td><a href="MainPage.html">Home</a></td>
		<td><a href="contactinfo.html">Contact</a></td>
		<td><a href="events.html">Events</a></td>
		<td><a href="import.html">Import</a></td>	
		<td><a href="ClientManagement.html">Clients</a></td>
		<td><a href="EmployeeManagement.html">Employees</a></td>
		<td><a href="logout.html">Logout</a></td>
		<td id="userWelcome" style="text-align: right; width: 100%"></td>
	</tr>
	</table>
</div>
        <div id='bodydiv' style="margin:auto;
                            background-color:white;
                            padding:10px;
                            transform: translate(0px, 25px);
                            max-width:370px;
                            border-style:solid;
                            border-width:2px;">
            
            <form id='testform' method="post">
                <fieldset>
                    <div style="margin:auto;">
                        <legend>Guest List Import</legend>
                        <!--<label>Get Button <input id='gobox' type="button" value="Click for a GET request" /></label>-->
                        <input id="uploadfile" type="file" accept=".csv" />
                        <input id='submitbox' type="submit" value="Upload" />
                        <br /><span id="uploaderror" class="error"></span>
                    </div>
                </fieldset>
            </form>
        </div>
	</body>
	<script type="text/javascript">
        $(document).ready(function () {
            var getUrl = "/EagleEventPlanning/services/import";
            $('#gobox').click(function () {
                $.ajax({
                    url: getUrl,
                    type: 'GET',
                    complete: function(jqXHR, data) {
                        switch(jqXHR.status) {
                            case 200:
                                console.log("200 Received!\n" + jqXHR.statusText);
                                break;
                            default:
                                alert(jqXHR.status.toString() + " " + jqXHR.statusText);
                                break;
                        }
                    },
                    success: function(data, textStatus, jqXHR) {
                        console.log(data);
                    }
                });
            });
            $('#submitbox').click(function (e) {
                console.log("uploading...");
                var file = $('#uploadfile').get(0).files[0];                
                var uploadData = new FormData();
                uploadData.append('file', file);
                var id = 1;//localStorage.event;
                var postUrl = "/EagleEventPlanning/services/import/" + id + "/uploadfile";
                $.ajax({
	                url: postUrl,
	                type: 'POST',
	                data: uploadData,
	                cache: false,
	                contentType: false,
	                processData: false,
	                statusCode: {
                        200: function(response) {
                            alert(response.statusText);
	                    }
                    }     
	            });
            });
        });
    </script>
</html>